СЕМАФОРЫ (System V IPC)

* A (S, n) - увеличение значения семафора S на величину n
* D (S, n) - пока значение семафора S < n, блокировать процесс. Потом S = S - n
* Z (S) - процесс блокируется до тех пор, пока значение S не станет 0

Вызовы:

#include <sys/types.h>
#include <sys/ipc.h>
#include <sys/sem.h>

int semget(key_t key, int nsems, int semflg);
Возвращает дескриптор System V IPC массива семафоров (целое неотрицательное число) или -1 при ошибке.
key - ключ System V IPC (через ftok())
nsems - размер массива (кол-во семафоров)
semflg - флаги(например, IPC_CREAT | IPCEXCL - только создание, если уже есть такой массив семафоров, то ошибка) и права доступа

int semctl(int semid, int semnum, int cmd, union semun arg);
Предназначен для получения информации о массиве семафоров и изменения его атрибутов. Используем для удаления созданного массива семафоров из системы. Обычно возвращает 0, при ошибке вернёт -1.
Процессы, находящиеся в ожидании (при выполнении semop()), то после удаления массива семафоров они они разблокируются, а из вызова semop() вернётся -1 (ошибка)
	semid - дескриптор System V IPC массива семафоров
	cmd - команда (мы используем только IPC_RMID - удаление)
	semnum - количество семафоров в массиве (не используется при удалении, ставим 0)
	arg - не используется при удалении, ставим 0


int semop(int semid, struct sembuf *sops, int nsops);
Выполнение операций над массивом семафоров. Возвращает обычно 0, при ошибке вернёт -1.
	semid - дескриптор System V IPC массива семафоров
	sops - тип struct sembuf, (массив семафоров)
	nsops - количество элементов массива, у каждого элемента 3 перемемнные
	
	__Структура sembuf:__
	sem_num – номер в массиве IPC-семафоров (с нуля)
	sem_op – выполняемая операция
	sem_flg - флаги для операции (мы всегда используем 0)

	Для операции:
	A(S, n) -> sem_op = n,
	D(S, n) -> sem_op = -n,
	Z(S) -> sem_op = 0.


Команды командной строки:

ipcs – показать все объекты System V IPC
ipcrm sem <id> – удалить массив семафоров с таким id
(на macOS  это ipcrm -s <id>)